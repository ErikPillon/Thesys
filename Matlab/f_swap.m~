function final_state = f_swap(state, index, displacement)
% This function take a generic state of zeros and ones and create a new
% state with 1 in position (index+displacement) and 0 in position (index)
%
% INPUT
% displacement : 2x1 vector
%
% OUTPUT
%
d = displacement;

% foolproof check
if state(index) == 0
    error(message('f_swap:the desired state is empty'));
end

n = length(state)

if state(1+mod(index+displacement-1,n)) == 1
    error(message('f_swap:1 is found instead of 0 in position index+displacement'));
end

final_state = state;
final_state(index) = 0;
% in the following 1+mod(-1,...) is for menaging properly the zeros in the
% arrays

dims = sqrt(n);

x = ceil(index/dims);
y = mod(index,dims);
M = reshape(final_state,[4,4]);

M(1+mod(x+d(1)-1,dims),1+mod(y+d(1)-1,dims)) = 1;
final_state = reshape(M,[1,n]);
